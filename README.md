# Crusties — AI-Generated Pizza NFTs on Base

> **Your Farcaster identity, baked into a one-of-a-kind pizza PFP.**

Crusties is an AI-powered NFT collection of **3,333 unique pizza profile pictures (PFPs)** minted on the **Base** network. Each Crustie is generated by analyzing your Farcaster activity, cast history, engagement patterns, and on-chain personality — then baking it all into a pizza avatar that's uniquely *you*.

Mint with **Base ETH** (0.001 ETH) or **USDC** ($3). All metadata and images are stored on **IPFS** for permanent, decentralized ownership.

Distributed as a **Farcaster Mini App** — users discover Crusties in feeds, open it in-app, and mint without leaving Farcaster.

---

## How It Works

1. **Connect** — Open Crusties inside Farcaster (or any wallet browser). Your identity is detected automatically via the Mini App SDK.
2. **Analyze** — Our AI reads your casts, engagement metrics, social graph, and on-chain activity on Base.
3. **Generate** — A unique pizza PFP is created that matches your vibe. Traits include crust style, cheese type, toppings, sauce, eyes, nose, background, accessories, and a vibe tag.
4. **Preview** — See your Crustie and its traits before minting. Not your vibe? Re-roll for a fresh one.
5. **Mint** — Pay with ETH or USDC. Your NFT metadata and image are pinned to IPFS, and the URI is stored on-chain.
6. **Share** — Show off your Crustie on Farcaster and set it as your PFP.

---

## Collection Details

| Detail                   | Value                                                 |
| ------------------------ | ----------------------------------------------------- |
| **Collection Name**      | Crusties                                              |
| **Token Symbol**         | CRUSTIES                                              |
| **Network**              | Base (Chain ID 8453)                                  |
| **Token Standard**       | ERC-721 (with ERC-2981 Royalties + ERC-721URIStorage) |
| **Max Supply**           | 3,333                                                 |
| **Max Mints Per Wallet** | 3                                                     |
| **ETH Mint Price**       | 0.001 ETH                                             |
| **USDC Mint Price**      | $3 USDC                                               |
| **USDC Contract**        | `0x833589fCD6eDb6E08f4c7C32D4f71b54bdA02913`          |
| **Metadata Storage**     | IPFS (via Pinata)                                     |
| **Royalties**            | 2.5% on secondary sales (ERC-2981)                    |

---

## UI/UX Design Breakdown

Crusties uses a **single-page app architecture** with a screen state machine. No route changes — the app transitions between 7 distinct screens based on user actions. The entire UI is mobile-first, capped at 480px max width, and designed to feel native inside Farcaster clients.

### Design System

**Typography:**
- **Display font:** Luckiest Guy (Google Fonts) — used for all headings, buttons, and accent text. Gives a fun, chunky, pizza-parlor vibe.
- **Body font:** Inter (Google Fonts) — clean sans-serif for readable body text and labels.

**Color Palette:**

| Token            | Hex       | Usage                                              |
| ---------------- | --------- | -------------------------------------------------- |
| `orange-primary` | `#E85D04` | Primary brand color — headings, buttons, borders   |
| `orange-dark`    | `#C44900` | Button hover states, gradients                     |
| `orange-light`   | `#FFF3E0` | Light card backgrounds, unselected payment options  |
| `cream`          | `#FFFDF7` | Page background base color                         |
| `crust-brown`    | `#8B5E3C` | Secondary text, label text                         |
| `cheese-yellow`  | `#FFD166` | Accent highlights, trait badges, selected states   |
| `tomato-red`     | `#E63946` | Error states, alerts                               |
| `basil-green`    | `#2D6A4F` | Success accents, confetti                          |
| `charcoal`       | `#1D1D1D` | Body text color                                    |
| `muted-text`     | `#6B7280` | Caption/label text                                 |

**Component Styling Patterns:**
- **Cards** (`.crusties-card`): White background, rounded-3xl corners, 4px orange-primary border, 6px offset box-shadow in rgba(232, 93, 4, 0.3)
- **Primary buttons** (`.crusties-btn`): Orange-primary fill, orange-dark border, white Luckiest Guy text at 24px, 6px box-shadow, hover scale-105, active scale-95
- **Secondary buttons** (`.crusties-btn-secondary`): Semi-transparent white with backdrop-blur, white border, 4px box-shadow
- **Grid items**: Rounded-2xl, 4px orange-primary border, 4px offset shadow

**Animations:**
- `spin-slow` — 20s full rotation (floating background emojis)
- `float` — 3s vertical bounce + slight rotation (ingredient emojis)
- `confetti` — 2.5s fall from top with rotation and fade-out
- `bounce` — Standard CSS bounce for loading dots and celebration

---

### Screen 1: Splash Screen

**Purpose:** Brand introduction + app initialization. Auto-transitions to Home after 2.5 seconds.

**Layout:**
- Full-screen orange gradient background (`from-orange-primary via-orange-dark to-crust-brown`)
- Centered content with bouncing pizza emoji (text-9xl) and cheese-yellow glow behind it
- "Crusties" in white Luckiest Guy at 56px
- "Baking your Crustie..." subtitle in white
- Three bouncing loading dots (staggered 150ms delays)
- Floating background emojis at 10% opacity: pizza, cheese, tomato, pepper — all with `spin-slow` animation at staggered delays

**Behavior:**
- Calls `sdk.actions.ready()` immediately to signal Farcaster that the app has loaded
- Auto-transitions to Home screen after 2500ms timeout

---

### Screen 2: Home Screen

**Purpose:** Main landing page. Shows collection stats, sample Crusties grid, and the primary CTA to mint.

**Layout:**
- Light cream background (`#FFFBF5`) with toppings pattern overlay at 22% opacity (stretched to cover, no repeat)
- **Header bar:** Logo image (48px rounded-xl) + "Crusties" text in orange-primary Luckiest Guy at 32px on left; User PFP circle (44px, 3px orange border) or placeholder person icon on right
- **Hero section:** "Every Slice Tells a Story" in orange-primary Luckiest Guy at 52px, single-line height. Subtitle "Your vibe. Your toppings. Your Crustie." in `#D42806` bold Luckiest Guy
- **3x3 Crustie Grid:** 9 sample pizza images in a CSS grid (grid-cols-3, gap-3). Each cell is a square with rounded-2xl corners, 4px orange-primary border, white bg, and offset shadow. Images: pepperoni-punk, mushroom-mystic, pineapple-pirate, basil-beast, hot-sauce-demon, cheese-phantom, olive-alien, truffle-royal, bbq-bandit
- **Stats Card** (`.crusties-card`): 3-column layout divided by cheese-yellow borders. Shows: Minted count (live from contract), ETH price (0.001), and "Your Mints" (X/3). Numbers in orange-primary Luckiest Guy at 3xl, labels in uppercase crust-brown at xs
- **Info text:** "We analyze your Farcaster identity to bake a one-of-a-kind pizza PFP just for you." in `#D42806` bold Luckiest Guy at lg
- **CTA Button:** When connected — full-width `.crusties-btn` with pizza emoji + "Get Your Slice" (or "Oven's Full!" when 3/3 minted). When not connected — centered RainbowKit ConnectButton

**Data displayed:**
- `totalMinted` — live read from smart contract
- `userMintCount` — derived from `remainingMintsForWallet(address)` contract call
- User PFP — from `sdk.context.user.pfpUrl` via Farcaster SDK

---

### Screen 3: Generating Screen

**Purpose:** Loading state while the backend analyzes the user's profile and generates their pizza PFP via AI.

**Layout:**
- Full-screen orange gradient (`from-orange-primary to-orange-dark`)
- **Header:** Back arrow button (white, left), "Baking..." title (white Luckiest Guy 32px, center)
- **Spinning pizza:** Massive pizza emoji (180px) with continuous 3s spin animation, cheese-yellow glow blur behind it, sparkle emojis pinging on corners
- Floating ingredient emojis (cheese, tomato, pepper, olive) at 20% opacity with `float` animation
- **Title:** "Baking Your Crustie..." in white Luckiest Guy at 44px
- **Rotating puns:** Cycles every 3 seconds through pizza-themed loading messages:
  - "Analyzing your on-chain flavor profile..."
  - "Selecting the perfect toppings..."
  - "Adding extra cheese for good measure..."
  - "Preheating the blockchain oven..."
  - "Almost ready — just a bit more crust..."
- **Progress bar:** Rounded-full bar with white/30 border, cheese-yellow gradient fill, increments 1% every 200ms up to 95%. Shows "X% complete" text below

**Behavior:**
- Progress bar fills to 95% then holds (never reaches 100% until generation completes)
- When `generatedData` is available and `isGenerating` is false, auto-transitions to Preview
- Back button returns to Home

---

### Screen 4: Preview Screen

**Purpose:** Shows the generated Crustie image and traits. User chooses payment method and mints.

**Layout:**
- Light cream background (`#FFFBF5`) with toppings pattern overlay at 22% opacity (same as Home)
- **Header:** Back arrow (orange-primary, left), "Your Crustie" (orange-primary Luckiest Guy 32px, center)
- **Scrollable content area** (with bottom padding for fixed mint bar):
  - **PFP Preview Card** (`.crusties-card`): Square image in rounded-2xl frame with 4px cheese-yellow border and offset shadow. "Your Crustie is Ready!" heading. "That's amore! Here's your one-of-a-kind slice." subtitle in `#D42806`
  - **Traits Card** (`.crusties-card`): Sparkle emoji + "Traits" heading. 2-column grid of trait badges — each badge is cheese-yellow bg with orange-primary border, rounded-2xl, shows emoji icon + trait label (muted-text, xs) + trait value (bold, sm). Trait emojis: crust=bread, cheese=cheese, topping=meat, eyes=sleepy, vibe=money, rarity=star, sauce=tomato, background=palette, accessories=hat, mouth=lips, nose=nose
  - **Payment Selector Card** (`.crusties-card`): "Choose Payment" heading. Two side-by-side cards (grid-cols-2):
    - **ETH option:** Blue gradient circle with diamond icon, "0.001" in Luckiest Guy, "ETH" label. When selected: cheese-yellow bg, orange-primary border, scale-105
    - **USDC option:** Blue circle with $ icon, "$3" in Luckiest Guy, "USDC" label. Same selected state styling
  - Unselected cards: orange-light bg, crust-brown border
- **Fixed bottom bar:** Gradient from cheese-yellow to transparent. Contains:
  - Primary mint button (`.crusties-btn`): Shows contextual text — "Mint for 0.001 ETH", "Approve USDC", "Mint for $3 USDC", "Approving...", "Minting...", or "Confirming..." with spinner
  - Re-roll link: "Not your vibe? Re-roll!" in orange-primary Luckiest Guy

**Behavior:**
- Payment method defaults to ETH
- USDC flow is two-step: Approve first, then Mint
- On successful mint → transition to Success screen
- On error → transition to Error screen
- Re-roll → back to Generating screen with fresh generation

---

### Screen 5: Minting Screen

**Purpose:** Transaction confirmation loading state while the mint tx is pending on Base.

**Layout:**
- Full-screen orange gradient (`from-orange-primary to-orange-dark`)
- Floating pizza emojis at 10% opacity with `float` animation
- **NFT image** (288px square, rounded-3xl, 6px white border, heavy box-shadow) with dark gradient overlay and centered spinner (white ring with fire emoji inside)
- Cheese-yellow glow blur behind the image
- **Title:** "In The Oven..." in white Luckiest Guy at 48px
- **Subtitle:** "Your transaction is being confirmed on Base. This won't take long!" in white bold Luckiest Guy
- **BaseScan link:** White pill button with external link icon, "View on BaseScan" — links to `basescan.org/tx/{hash}`. Hover turns cheese-yellow, scale-105
- Three bouncing loading dots at bottom (staggered delays)

---

### Screen 6: Success Screen

**Purpose:** Celebration! Shows the minted NFT with sharing options.

**Layout:**
- Full-screen orange-to-brown gradient (`from-orange-primary via-orange-dark to-crust-brown`)
- **Confetti animation:** 60 colored squares (cheese-yellow, orange-light, basil-green, white, orange-primary) falling from top with rotation, staggered delays, fades out after 3 seconds
- Bouncing party emoji (text-8xl) at top
- **NFT image** (288px square, rounded-3xl, 6px cheese-yellow border) with dramatic yellow glow (`box-shadow: 0 0 60px rgba(255, 209, 102, 0.8)`)
- **Title:** "You're a Crustie!" in white Luckiest Guy at 52px
- **Subtitle:** "You're officially a slice of the collection." in white bold Luckiest Guy
- **Token ID badge:** White pill with cheese-yellow border, "Crustie #42" in orange-primary Luckiest Guy (shown when tokenId is available)
- **Action buttons** (full-width, stacked):
  - "Share on Farcaster" — White fill, orange-primary text, upload icon. Opens Warpcast compose with pre-filled text: "I just minted my Crustie! #Crusties #Base"
  - "View on BaseScan" — Secondary style (`.crusties-btn-secondary`), external link icon
- **Mint Another section** (shown when remaining mints > 0): Underlined white link "Mint Another Slice" with pizza emoji, "You have X/3 mints left" below

---

### Screen 7: Error Screen

**Purpose:** Graceful error handling with retry options.

**Layout:**
- Full-screen orange-to-brown gradient (`from-orange-primary to-crust-brown`)
- **Burnt pizza visual:** 256px square in charcoal bg, grayscale filter, 6px orange-dark border, heavy shadow. Large pizza emoji at 60% opacity inside. Dark gradient overlay. Fire emoji bouncing on bottom-right corner, crying emoji on top-left
- **Title:** "That Crust Crumbled" in white Luckiest Guy at 44px
- **Error message:** Dynamic text in white bold Luckiest Guy (e.g., "You've reached the max mints per wallet (3)" or "Transaction failed. Please try again.")
- **Action buttons:**
  - "Try Again" — White fill, orange-primary text, refresh icon. Hover turns cheese-yellow. Returns to Preview screen
  - "Back to Home" — Secondary style (`.crusties-btn-secondary`), home icon. Returns to Home screen
- **Encouraging message:** "Don't worry! Even the best pizzas sometimes need a second try." in white bold Luckiest Guy

---

### Screen Flow State Machine

```
splash ──(2.5s timer)──> home
home ──(Get Your Slice)──> generating
generating ──(AI complete)──> preview
generating ──(Back)──> home
preview ──(Mint started)──> minting
preview ──(Re-roll)──> generating
preview ──(Back)──> home
minting ──(Tx confirmed)──> success
minting ──(Tx failed)──> error
success ──(Mint Another)──> generating
error ──(Try Again)──> preview
error ──(Back to Home)──> home
```

### Responsive & Platform Considerations

- All screens capped at `max-w-[480px]` with `mx-auto` for centering on desktop
- Main content wrapper applies `paddingTop: env(safe-area-inset-top)` when running inside a Farcaster Mini App (`isInMiniApp` flag)
- IPFS image URLs are resolved through a helper that converts `ipfs://` to Pinata gateway URLs (`https://gateway.pinata.cloud/ipfs/`)
- RainbowKit uses a custom light theme with `#E85D04` accent color

---

## Architecture Overview

```
┌─────────────────────────────────────────────────────┐
│                   Farcaster Client                  │
│              (Mini App / Warpcast)                   │
└──────────────────────┬──────────────────────────────┘
                       │
                       ▼
┌─────────────────────────────────────────────────────┐
│              Next.js Frontend (Vercel)               │
│                                                     │
│  • State machine: 7 screens (splash → success)      │
│  • Wagmi v2 + RainbowKit for wallet connection      │
│  • Farcaster Mini App SDK for context + identity     │
│  • TailwindCSS + Luckiest Guy font                   │
└──────────────────────┬──────────────────────────────┘
                       │
                       ▼
┌─────────────────────────────────────────────────────┐
│                  Backend API (Hono)                   │
│                                                     │
│  1. Fetch Farcaster profile + cast history (Neynar)  │
│  2. Analyze on-chain activity on Base (Viem)         │
│  3. Build trait vector from personality analysis     │
│  4. Generate AI pizza image (Replicate SDXL)         │
│  5. Pin image + metadata JSON to IPFS (Pinata)       │
│  6. Return IPFS URI to frontend for minting          │
└──────────────────────┬──────────────────────────────┘
                       │
                       ▼
┌─────────────────────────────────────────────────────┐
│              CrustiesNFT Smart Contract              │
│                   (Base Mainnet)                     │
│                                                     │
│  • mintWithETH(tokenURI) — pay with Base ETH         │
│  • mintWithToken(tokenURI, amount) — pay with USDC   │
│  • ERC-721 + URIStorage + ERC-2981 Royalties         │
│  • Max 3,333 supply · 3 per wallet                   │
│  • Treasury receives all payments                    │
└─────────────────────────────────────────────────────┘
                       │
                       ▼
┌─────────────────────────────────────────────────────┐
│                       IPFS                           │
│                                                     │
│  • Pizza PFP image (PNG, 1024x1024)                  │
│  • Metadata JSON (name, description, image, traits)  │
└─────────────────────────────────────────────────────┘
```

---

## Smart Contract

The `CrustiesNFT` contract is modeled after a reference ERC-721 pattern on Base.

- **Solidity:** `^0.8.24` (compiled with 0.8.31, optimizer 200 runs)
- **OpenZeppelin:** v5.x (ERC721, ERC721URIStorage, ERC721Royalty, Ownable)

### Key Functions

- `mintWithETH(string _tokenURI)` — Mint by paying minimum ETH. ETH forwarded to treasury. Returns tokenId.
- `mintWithToken(string _tokenURI, uint256 tokenAmount)` — Mint by paying USDC. User must `approve()` contract first. Returns tokenId.
- `canMint(address wallet)` — Returns whether a wallet can still mint.
- `remainingMintsForWallet(address wallet)` — Returns remaining mints for a wallet (out of 3).
- `remainingSupply()` — Returns how many Crusties remain unminted.

### Owner-Only Admin Functions

- `setMinEthPrice(uint256)` — Update minimum ETH mint price
- `setMinTokenPrice(uint256)` — Update minimum USDC mint price
- `setMaxMintsPerWallet(uint256)` — Update per-wallet mint cap
- `setTreasury(address)` — Update treasury address
- `setDefaultRoyalty(address, uint96)` — Update royalty receiver and basis points

### Constructor Parameters

```solidity
constructor(
    address _paymentToken,   // USDC token address
    address _treasury,       // Treasury wallet for mint revenue
    uint256 _minEthPrice,    // Minimum ETH to mint (in wei)
    uint256 _minTokenPrice   // Minimum USDC to mint (6 decimals)
)
```

---

## AI Image Generation Pipeline

### Personality Analysis

The backend analyzes the user's Farcaster and on-chain data to build a **trait vector** that determines their pizza's appearance:

| Data Source                                | Trait Influence                                                   |
| ------------------------------------------ | ----------------------------------------------------------------- |
| Cast frequency & tone                      | Crust style (thin, thick, stuffed, deep dish)                     |
| Engagement level (likes, recasts)          | Cheese meltiness / coverage                                       |
| Topic interests (from cast content)        | Topping selection (pepperoni for sports, mushrooms for art, etc.) |
| Social graph size                          | Pizza size / slice count                                          |
| On-chain activity (DeFi, NFTs, governance) | Eyes, expression, accessories                                     |
| Wallet age & tx count                      | Sauce style (classic red, white, pesto, BBQ)                      |
| Token holdings                             | Background color / pattern                                        |

### Trait Categories

| Trait        | Example Values                                              |
| ------------ | ----------------------------------------------------------- |
| **Crust**    | thin, thick, stuffed, deep_dish, cauliflower                |
| **Cheese**   | classic_mozzarella, extra_melty, four_cheese, vegan, smoked |
| **Topping**  | pepperoni, mushroom, pineapple, truffle, hot_peppers        |
| **Sauce**    | classic_red, white_alfredo, pesto, bbq, hot_honey           |
| **Eyes**     | sleepy, wide, laser, heart, diamond                         |
| **Nose**     | button, pointy, round, snub, freckled                       |
| **Background** | pepperoni_red, cheese_cave, night_sky, pizza_box, neon    |
| **Accessory** | none, party_hat, monocle, gold_chain, crown, headphones    |
| **Vibe**     | DeFi Degen, NFT Collector, Shitposter Supreme, Lurker       |
| **Rarity**   | 1–100 numeric score                                         |

### Generation Flow

1. Frontend sends `POST /api/generate { fid }` to backend
2. Backend fetches Farcaster data (Neynar API) + on-chain data (Viem/Base RPC)
3. Personality engine computes trait selections from data
4. AI prompt built from traits → sent to Replicate (Stability SDXL, 1024x1024)
5. Generated image pinned to IPFS via Pinata → returns image CID
6. Metadata JSON constructed with all traits as ERC-721 attributes → pinned to IPFS
7. Backend returns `{ ipfsUri, imageUrl, traits }` to frontend

### Metadata Format (ERC-721 Standard)

```json
{
  "name": "Crusties #42",
  "description": "A one-of-a-kind AI-generated pizza PFP based on your Farcaster vibe.",
  "image": "ipfs://QmXxx.../crusties-42.png",
  "external_url": "https://crusties.xyz/nft/42",
  "attributes": [
    { "trait_type": "Crust", "value": "Deep Dish" },
    { "trait_type": "Cheese", "value": "Extra Melty Mozzarella" },
    { "trait_type": "Topping", "value": "Pepperoni" },
    { "trait_type": "Sauce", "value": "Classic Red" },
    { "trait_type": "Eyes", "value": "Sleepy" },
    { "trait_type": "Nose", "value": "Button" },
    { "trait_type": "Background", "value": "Pepperoni Red" },
    { "trait_type": "Accessory", "value": "Gold Chain" },
    { "trait_type": "Vibe", "value": "DeFi Degen" },
    { "trait_type": "Rarity Score", "display_type": "number", "value": 87 }
  ]
}
```

---

## Project Structure

```
CrustiesNFTs/
├── src/
│   └── CrustiesNFT.sol              # Main NFT contract (Solidity ^0.8.24)
├── script/
│   └── Deploy.s.sol                 # Foundry deployment script
├── test/
│   └── CrustiesNFT.t.sol            # Foundry tests (MockUSDC + full coverage)
├── backend/
│   ├── src/
│   │   ├── index.ts                 # Hono API server entry point
│   │   ├── routes/
│   │   │   └── generate.ts          # POST /api/generate endpoint
│   │   ├── farcaster.ts             # Neynar API integration
│   │   ├── onchain.ts               # Viem Base chain data fetching
│   │   ├── personality.ts           # Trait vector computation engine
│   │   ├── generator.ts             # Replicate SDXL image generation
│   │   ├── ipfs.ts                  # Pinata IPFS pinning
│   │   ├── metadata.ts              # ERC-721 metadata JSON builder
│   │   └── __tests__/
│   │       └── personality.test.ts  # Vitest personality engine tests
│   ├── scripts/
│   │   └── generate-grid.ts         # Script to generate 9 homepage grid images
│   └── package.json
├── frontend/
│   ├── src/
│   │   ├── app/
│   │   │   ├── page.tsx             # Main page — screen state machine orchestrator
│   │   │   ├── layout.tsx           # Root layout with metadata + fc:miniapp tag
│   │   │   ├── providers.tsx        # Wagmi + RainbowKit + QueryClient setup
│   │   │   ├── globals.css          # Tailwind + fonts + utility classes + animations
│   │   │   └── .well-known/
│   │   │       └── farcaster.json/
│   │   │           └── route.ts     # Farcaster manifest API route
│   │   ├── components/
│   │   │   ├── SplashScreen.tsx     # Animated brand splash (2.5s)
│   │   │   ├── HomeScreen.tsx       # Landing page with grid + stats + CTA
│   │   │   ├── GeneratingScreen.tsx # AI generation loading with progress bar
│   │   │   ├── PreviewScreen.tsx    # NFT preview + traits + payment + mint
│   │   │   ├── MintingScreen.tsx    # Transaction confirmation loading
│   │   │   ├── SuccessScreen.tsx    # Celebration + share + mint another
│   │   │   ├── ErrorScreen.tsx      # Error display + retry/home
│   │   │   ├── MintButton.tsx       # Payment method toggle + contract calls
│   │   │   ├── PizzaPreview.tsx     # IPFS image display + trait formatting
│   │   │   └── WalletConnect.tsx    # RainbowKit wrapper
│   │   ├── hooks/
│   │   │   ├── useCrusties.ts       # Contract reads + backend generate calls
│   │   │   └── useFarcasterContext.ts # Farcaster SDK context extraction
│   │   └── lib/
│   │       ├── contract.ts          # ABI + contract/USDC addresses
│   │       └── wagmi.ts             # Wagmi config (Base chain + connectors)
│   ├── public/
│   │   └── images/
│   │       ├── logo.png             # Crusties logo (used in header + splash)
│   │       ├── toppings-pattern.png # Background pattern for Home + Preview
│   │       ├── IMG_3692.jpeg        # Base Crustie reference drawing
│   │       └── grid/                # AI-generated grid images (9 variations)
│   ├── tailwind.config.ts           # Custom colors, fonts, animations
│   └── package.json
├── public/
│   └── images/                      # Root-level image assets
├── foundry.toml                     # Foundry config (solc 0.8.31, optimizer 200)
├── CLAUDE.md                        # AI assistant project context
├── README.md                        # This file
└── .env.example                     # Environment variable template
```

---

## Tech Stack

| Layer              | Technology                                               |
| ------------------ | -------------------------------------------------------- |
| **Smart Contract** | Solidity ^0.8.24, OpenZeppelin v5.x, Foundry             |
| **Backend API**    | Hono (TypeScript), Node.js                               |
| **AI Generation**  | Replicate API (Stability SDXL, 1024x1024)                |
| **IPFS Pinning**   | Pinata (pinata-web3 SDK)                                 |
| **Farcaster Data** | Neynar API                                               |
| **On-Chain Data**  | Viem via Base RPC                                        |
| **Frontend**       | Next.js 14 (App Router), TailwindCSS, Luckiest Guy font |
| **Wallet**         | Wagmi v2, Viem, RainbowKit v2                            |
| **Farcaster SDK**  | @farcaster/miniapp-sdk, @farcaster/miniapp-wagmi-connector |
| **Testing**        | Foundry (forge test), Vitest (backend)                   |
| **Deployment**     | Foundry (contracts), Vercel (frontend)                   |

---

## Environment Variables

```env
# Contract Deployment
PRIVATE_KEY=0x...
TREASURY_ADDRESS=0x...
USDC_TOKEN_ADDRESS=0x833589fCD6eDb6E08f4c7C32D4f71b54bdA02913
MIN_ETH_PRICE=1000000000000000
MIN_TOKEN_PRICE=3000000

# RPC
BASE_RPC_URL=https://mainnet.base.org
BASE_SEPOLIA_RPC_URL=https://sepolia.base.org

# Verification
BASESCAN_API_KEY=...

# IPFS
PINATA_API_KEY=...
PINATA_SECRET_KEY=...

# Farcaster
NEYNAR_API_KEY=...

# AI Generation
REPLICATE_API_KEY=...

# Frontend
NEXT_PUBLIC_CONTRACT_ADDRESS=0x...
NEXT_PUBLIC_CHAIN_ID=8453
NEXT_PUBLIC_WALLETCONNECT_PROJECT_ID=...
```

---

## Development Setup

### Prerequisites

- Node.js >= 18
- Foundry (`curl -L https://foundry.paradigm.xyz | bash && foundryup`)
- Git

### Install & Build

```bash
# Clone
git clone https://github.com/Kingkill666/CrustiesNFTs.git
cd CrustiesNFTs

# Install contract dependencies
forge install

# Install backend dependencies
cd backend && npm install

# Install frontend dependencies
cd ../frontend && npm install
```

### Run Dev Servers

```bash
# Backend (from backend/)
npm run dev

# Frontend (from frontend/)
npm run dev
```

### Compile & Test Contracts

```bash
forge build
forge test -vvv
```

### Deploy to Base

```bash
forge script script/Deploy.s.sol --rpc-url $BASE_RPC_URL --broadcast --verify
```

### Generate Homepage Grid Images

```bash
# Requires REPLICATE_API_KEY with billing set up
cd backend && npx tsx scripts/generate-grid.ts
```

---

## Minting Flow (End-to-End)

```
User opens Crusties in Farcaster
        │
        ▼
Splash screen (2.5s) → sdk.actions.ready()
        │
        ▼
Home screen — user taps "Get Your Slice"
        │
        ▼
Frontend calls backend: POST /api/generate { fid }
        │
        ▼
Backend fetches Farcaster data (Neynar) + on-chain data (Base RPC)
        │
        ▼
Personality engine computes trait vector
        │
        ▼
AI generates pizza PFP via Replicate SDXL (1024x1024)
        │
        ▼
Image pinned to IPFS (Pinata) → returns image CID
        │
        ▼
Metadata JSON constructed with traits + image CID → pinned to IPFS
        │
        ▼
Backend returns { ipfsUri, imageUrl, traits } to frontend
        │
        ▼
Preview screen — user sees their Crustie + traits
        │
        ▼
User chooses payment: ETH or USDC
        │
        ├─ ETH: contract.mintWithETH(ipfsUri, { value: 0.001 ETH })
        │
        └─ USDC: usdc.approve(contractAddr, 3000000)
                 then contract.mintWithToken(ipfsUri, 3000000)
        │
        ▼
Minting screen — "In The Oven..." + BaseScan link
        │
        ▼
Success screen — confetti + Share on Farcaster + Mint Another
```

---

## Reference Contract

This project's smart contract follows an ERC-721 pattern with dual payment (ETH + ERC-20):

- **Pattern:** ERC-721 + URIStorage + ERC-2981 Royalties
- **Payment:** ETH and USDC, with pizza-themed naming and metadata

---

## Deployment Checklist

- [ ] Sign Farcaster manifest (use [Manifest Tool](https://farcaster.xyz/~/developers/mini-apps/manifest) or [Base Build](https://www.base.dev/preview?tab=account))
- [ ] Add public assets: `og-image.png`, `icon.png`, `splash.png`
- [ ] Add Replicate billing and generate 9 homepage grid images
- [ ] Deploy CrustiesNFT to Base Sepolia
- [ ] Verify contract on BaseScan (Sepolia)
- [ ] Test mint with ETH on testnet
- [ ] Test mint with USDC on testnet
- [ ] Deploy backend to staging
- [ ] Test full flow: generate → preview → mint on testnet
- [ ] Deploy CrustiesNFT to Base Mainnet
- [ ] Verify contract on BaseScan (Mainnet)
- [ ] Set production mint prices
- [ ] Deploy backend + frontend to production (Vercel)
- [ ] Test mainnet flow end-to-end
- [ ] Publish on Farcaster + Base app

---

## License

MIT
