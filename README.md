# ğŸ• Crusties â€” AI-Generated Pizza NFTs on Base

> **Your Farcaster identity, baked into a one-of-a-kind pizza PFP.**

Crusties is an AI-powered NFT collection of **3,333 unique pizza profile pictures (PFPs)** minted on the **Base** network. Each Crustie is generated by analyzing your Farcaster activity, cast history, engagement patterns, and on-chain personality â€” then baking it all into a pizza avatar that's uniquely *you*.

Mint with **Base ETH** or **USDC** (`0x833589fCD6eDb6E08f4c7C32D4f71b54bdA02913`). All metadata and images are stored on **IPFS** for permanent, decentralized ownership.

---

## How It Works

1. **Connect** â€” Open Crusties inside Farcaster to link your identity.
2. **Analyze** â€” Our AI reads your casts, engagement metrics, social graph, and on-chain activity.
3. **Generate** â€” A unique pizza PFP is created that matches your vibe. Traits include crust style, cheese type, eyes, nose, toppings, sauce drip, and more â€” all layered on top of the base Crustie outline you provide.
4. **Mint** â€” Pay with Base ETH or USDC. Your NFT metadata and image are pinned to IPFS, and the IPFS URI is stored on-chain.

---

## Collection Details


| Detail                   | Value                                                 |
| ------------------------ | ----------------------------------------------------- |
| **Collection Name**      | Crusties                                              |
| **Token Symbol**         | CRUSTIES                                              |
| **Network**              | Base (Chain ID 8453)                                  |
| **Token Standard**       | ERC-721 (with ERC-2981 Royalties + ERC-721URIStorage) |
| **Max Supply**           | 3,333                                                 |
| **Max Mints Per Wallet** | 3                                                     |
| **Payment Options**      | Base ETH Â· USDC (ERC-20)                              |
| **USDC Contract**        | `0x833589fCD6eDb6E08f4c7C32D4f71b54bdA02913`          |
| **Metadata Storage**     | IPFS (via Pinata / nft.storage)                       |
| **Royalties**            | 2.5% on secondary sales (ERC-2981)                    |


---

## Architecture Overview

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   Farcaster Client                  â”‚
â”‚              (Frame / Mini-App Entry)                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  Backend API Server                  â”‚
â”‚                                                     â”‚
â”‚  1. Fetch Farcaster profile + cast history           â”‚
â”‚  2. Analyze on-chain activity (Base)                 â”‚
â”‚  3. Build trait vector from personality analysis     â”‚
â”‚  4. Generate AI pizza image (trait-based prompting)  â”‚
â”‚  5. Pin image + metadata JSON to IPFS               â”‚
â”‚  6. Return IPFS URI to frontend for minting          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              CrustiesNFT Smart Contract              â”‚
â”‚                   (Base Mainnet)                     â”‚
â”‚                                                     â”‚
â”‚  â€¢ mintWithETH(tokenURI) â€” pay with Base ETH         â”‚
â”‚  â€¢ mintWithToken(tokenURI, amount) â€” pay with USDC   â”‚
â”‚  â€¢ ERC-721 + URIStorage + ERC-2981 Royalties         â”‚
â”‚  â€¢ Max 3,333 supply Â· 3 per wallet                   â”‚
â”‚  â€¢ Treasury receives all payments                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       IPFS                           â”‚
â”‚                                                     â”‚
â”‚  â€¢ Pizza PFP image (PNG)                             â”‚
â”‚  â€¢ Metadata JSON (name, description, image, traits)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Smart Contract

The `CrustiesNFT` contract is modeled directly after the PizzaFriends contract with pizza-themed modifications.

### Key Functions

`**mintWithETH(string calldata _tokenURI)**` â€” Mint a Crustie NFT by paying the minimum ETH price. ETH is forwarded to the treasury. The `_tokenURI` is the IPFS URI pointing to the metadata JSON (which itself links to the IPFS-hosted pizza image).

`**mintWithToken(string calldata _tokenURI, uint256 tokenAmount)**` â€” Mint a Crustie NFT by paying with USDC. The user must first `approve()` the contract to spend their USDC. Tokens are transferred to the treasury.

`**canMint(address wallet)**` â€” Returns whether a wallet can still mint (under per-wallet cap and supply cap).

`**remainingMintsForWallet(address wallet)**` â€” Returns how many mints a wallet has left.

`**remainingSupply()**` â€” Returns how many Crusties remain unminted.

### Owner-Only Admin Functions

- `setMinEthPrice(uint256)` â€” Update minimum ETH mint price
- `setMinTokenPrice(uint256)` â€” Update minimum USDC mint price
- `setMaxMintsPerWallet(uint256)` â€” Update per-wallet mint cap
- `setTreasury(address)` â€” Update treasury address
- `setDefaultRoyalty(address, uint96)` â€” Update royalty receiver and basis points

### Constructor Parameters

```solidity
constructor(
    address _paymentToken,   // USDC token address
    address _treasury,       // Treasury wallet for mint revenue
    uint256 _minEthPrice,    // Minimum ETH to mint (in wei)
    uint256 _minTokenPrice   // Minimum USDC to mint (6 decimals)
)
```

### Dependencies

- OpenZeppelin Contracts v5.x: `ERC721`, `ERC721URIStorage`, `ERC721Royalty`, `Ownable`, `IERC20`
- Solidity `^0.8.20`

---

## AI Image Generation Pipeline

### Personality Analysis

The backend analyzes the user's Farcaster and on-chain data to build a **trait vector** that determines their pizza's appearance:


| Data Source                                | Trait Influence                                                   |
| ------------------------------------------ | ----------------------------------------------------------------- |
| Cast frequency & tone                      | Crust style (thin, thick, stuffed, deep dish)                     |
| Engagement level (likes, recasts)          | Cheese meltiness / coverage                                       |
| Topic interests (from cast content)        | Topping selection (pepperoni for sports, mushrooms for art, etc.) |
| Social graph size                          | Pizza size / slice count                                          |
| On-chain activity (DeFi, NFTs, governance) | Eyes, expression, accessories                                     |
| Wallet age & tx count                      | Sauce style (classic red, white, pesto, BBQ)                      |
| Token holdings                             | Background color / pattern                                        |


### Base Traits (Artist-Provided)

The project creator provides the **base Crustie artwork** including:

- Main pizza outline / silhouette
- Crust variations
- Eye styles
- Nose shapes
- Cheese patterns
- Base color palette

These base assets are combined with AI-generated variations to produce the final PFP.

### Generation Flow

1. Fetch user data from Farcaster Hub API + Base RPC
2. Run personality analysis â†’ output trait selections
3. Compose image prompt using trait selections + base art style
4. Generate image via AI (e.g., Stable Diffusion, DALLÂ·E, or custom model)
5. Post-process: overlay base traits onto generated output, ensure consistent style
6. Upload final PNG to IPFS
7. Construct metadata JSON with all trait attributes â†’ upload to IPFS
8. Return IPFS metadata URI for on-chain minting

### Metadata Format (ERC-721 Standard)

```json
{
  "name": "Crusties #42",
  "description": "A one-of-a-kind AI-generated pizza PFP based on your Farcaster vibe.",
  "image": "ipfs://QmXxx.../crusties-42.png",
  "external_url": "https://crusties.xyz/nft/42",
  "attributes": [
    { "trait_type": "Crust", "value": "Deep Dish" },
    { "trait_type": "Cheese", "value": "Extra Melty Mozzarella" },
    { "trait_type": "Topping", "value": "Pepperoni" },
    { "trait_type": "Sauce", "value": "Classic Red" },
    { "trait_type": "Eyes", "value": "Sleepy" },
    { "trait_type": "Nose", "value": "Button" },
    { "trait_type": "Background", "value": "Pepperoni Red" },
    { "trait_type": "Vibe", "value": "DeFi Degen" },
    { "trait_type": "Rarity Score", "display_type": "number", "value": 87 }
  ]
}
```

---

## Project Structure

```
CrustiesNFTs/
â”œâ”€â”€ src/
â”‚   â””â”€â”€ CrustiesNFT.sol          # Main NFT contract
â”œâ”€â”€ script/
â”‚   â””â”€â”€ Deploy.s.sol             # Deployment script
â”œâ”€â”€ test/
â”‚   â””â”€â”€ CrustiesNFT.t.sol        # Foundry tests
â”œâ”€â”€ backend/
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ index.ts             # API server entry point
â”‚   â”‚   â”œâ”€â”€ farcaster.ts         # Farcaster data fetching
â”‚   â”‚   â”œâ”€â”€ onchain.ts           # On-chain activity analysis
â”‚   â”‚   â”œâ”€â”€ personality.ts      # Trait vector computation
â”‚   â”‚   â”œâ”€â”€ generator.ts        # AI image generation
â”‚   â”‚   â”œâ”€â”€ ipfs.ts              # IPFS pinning (Pinata / nft.storage)
â”‚   â”‚   â””â”€â”€ metadata.ts         # Metadata JSON construction
â”‚   â”œâ”€â”€ assets/
â”‚   â”‚   â””â”€â”€ base-traits/         # Artist-provided base trait PNGs
â”‚   â”œâ”€â”€ package.json
â”‚   â””â”€â”€ .env.example
â”œâ”€â”€ frontend/
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ app/                 # Next.js app (Farcaster Mini App compatible)
â”‚   â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”‚   â”œâ”€â”€ MintButton.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ PizzaPreview.tsx
â”‚   â”‚   â”‚   â””â”€â”€ WalletConnect.tsx
â”‚   â”‚   â”œâ”€â”€ hooks/
â”‚   â”‚   â”‚   â””â”€â”€ useCrusties.ts
â”‚   â”‚   â””â”€â”€ lib/
â”‚   â”‚       â”œâ”€â”€ contract.ts      # ABI + contract address
â”‚   â”‚       â””â”€â”€ wagmi.ts         # Wagmi/Viem config for Base
â”‚   â”œâ”€â”€ public/
â”‚   â””â”€â”€ package.json
â”œâ”€â”€ public/
â”‚   â””â”€â”€ .well-known/
â”‚       â””â”€â”€ farcaster.json       # Farcaster Mini App manifest
â”œâ”€â”€ foundry.toml                 # Foundry config
â”œâ”€â”€ CLAUDE.md                    # AI assistant project context
â”œâ”€â”€ README.md                    # This file
â””â”€â”€ .env.example
```

---

## Tech Stack


| Layer              | Technology                                                       |
| ------------------ | ---------------------------------------------------------------- |
| **Smart Contract** | Solidity ^0.8.20, OpenZeppelin v5, Foundry                       |
| **Backend API**    | Node.js / TypeScript, Express or Hono                            |
| **AI Generation**  | Stable Diffusion / DALLÂ·E / Replicate API                        |
| **IPFS Pinning**   | Pinata or nft.storage                                            |
| **Farcaster Data** | Neynar API / Farcaster Hub gRPC                                  |
| **On-Chain Data**  | Viem / ethers.js via Base RPC (Alchemy / QuickNode)              |
| **Frontend**       | Next.js, Wagmi v2, Viem, TailwindCSS                             |
| **Wallet Connect** | @farcaster/miniapp-wagmi-connector (Base chain)                  |
| **Testing**        | Foundry (forge test), Vitest (backend)                           |
| **Deployment**     | Foundry (forge script), Vercel (frontend), Railway/Fly (backend) |


---

## Environment Variables

```env
# Contract
PRIVATE_KEY=0x...
TREASURY_ADDRESS=0x...
USDC_TOKEN_ADDRESS=0x833589fCD6eDb6E08f4c7C32D4f71b54bdA02913
BASE_RPC_URL=https://mainnet.base.org
BASESCAN_API_KEY=...

# IPFS
PINATA_API_KEY=...
PINATA_SECRET_KEY=...
# or
NFT_STORAGE_API_KEY=...

# Farcaster
NEYNAR_API_KEY=...

# AI Generation
REPLICATE_API_KEY=...
# or
OPENAI_API_KEY=...

# Frontend
NEXT_PUBLIC_CONTRACT_ADDRESS=0x...
NEXT_PUBLIC_CHAIN_ID=8453
NEXT_PUBLIC_WALLETCONNECT_PROJECT_ID=...
```

---

## Development Setup

### Prerequisites

- Node.js >= 18
- Foundry (`curl -L https://foundry.paradigm.xyz | bash && foundryup`)
- Git

### Install & Build

```bash
# Clone
git clone https://github.com/Kingkill666/CrustiesNFTs.git
cd CrustiesNFTs

# Install contract dependencies
forge install

# Install backend dependencies
cd backend && npm install

# Install frontend dependencies
cd ../frontend && npm install
```

### Compile & Test Contracts

```bash
forge build
forge test -vvv
```

### Deploy to Base

```bash
forge script script/Deploy.s.sol --rpc-url $BASE_RPC_URL --broadcast --verify
```

---

## Minting Flow (End-to-End)

```
User opens Crusties Frame in Farcaster
        â”‚
        â–¼
Frontend calls backend: POST /api/generate { fid: 12345 }
        â”‚
        â–¼
Backend fetches Farcaster data (Neynar) + on-chain data (Base RPC)
        â”‚
        â–¼
Personality engine computes trait vector
        â”‚
        â–¼
AI generates pizza PFP image based on traits + base art
        â”‚
        â–¼
Image pinned to IPFS â†’ returns image CID
        â”‚
        â–¼
Metadata JSON constructed with traits + image CID â†’ pinned to IPFS
        â”‚
        â–¼
Backend returns IPFS metadata URI to frontend
        â”‚
        â–¼
User chooses payment: ETH or USDC
        â”‚
        â”œâ”€ ETH: Frontend calls contract.mintWithETH(ipfsURI, { value: ethAmount })
        â”‚
        â””â”€ USDC: Frontend calls usdc.approve(contractAddr, amount)
                 then contract.mintWithToken(ipfsURI, usdcAmount)
        â”‚
        â–¼
NFT minted! Token URI stored on-chain pointing to IPFS metadata.
User sees their unique Crustie PFP ğŸ•
```

---

## Reference Contract

This project's smart contract is modeled after the **PizzaFriends** NFT contract deployed on Base:

- **Contract:** `[0xfbEdf9D11B552c5272AaFb1ec63973CA823Bd2Ff](https://basescan.org/address/0xfbEdf9D11B552c5272AaFb1ec63973CA823Bd2Ff#code)`
- **Pattern:** ERC-721 + URIStorage + ERC-2981 Royalties + dual payment (ETH + ERC-20 token)
- **Key difference:** Crusties uses USDC instead of PizzaFriends' token, with pizza-themed naming and metadata

---

## Roadmap

- Finalize base Crustie artwork and trait assets
- Build and test CrustiesNFT smart contract
- Set up AI generation pipeline with personality analysis
- Build backend API (generate â†’ pin â†’ return URI)
- Build Farcaster Frame / Mini-App frontend
- Deploy contract to Base Sepolia testnet
- Community testing & feedback
- Mainnet deployment
- Launch mint on Farcaster

---

## License

MIT